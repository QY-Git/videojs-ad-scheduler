<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Ott Ad Scheduler</title>
  <!-- build:css(.) styles/vendor.css -->
  <!-- bower:css -->
  <link rel="stylesheet" href="bower_components/video.js/dist/video-js.css" />
  <!-- endbower -->
  <!-- endbuild -->
  <!-- build:css(.tmp) styles/main.css -->
  <!-- endbuild -->
  <link rel="stylesheet" href="bower_components/videojs-contrib-ads/src/videojs.ads.css" />
  <link rel="stylesheet" href="src/vast-button.css" />

  <style>
    body {
      font-family: Arial, sans-serif;
    }
    .info {
      background-color: #eee;
      border: thin solid #333;
      border-radius: 3px;
      padding: 0 5px;
      text-align: center;
    }
    .container {
      margin: 40px auto;
      text-align: center;
    }
    .container video {
      vertical-align: middle;
    }
  </style>
</head>
<body>
  <div class="info">
    <p>
      You can see the Ott Ad Scheduler plugin in action below.
      Look at the source of this page to see how to use it with your videos.
    </p>
  </div>
  <div class="container">
    <video id="video"
           class="video-js vjs-default-skin vjs-big-play-centered"
           height="480"
           width="720"
           controls>
      <p class="vjs-no-js">To view this video please enable JavaScript, and consider upgrading to a web browser that <a href="http://videojs.com/html5-video-support/" target="_blank">supports HTML5 video</a></p>
    </video>
  </div>

  <!-- build:js(.) scripts/vendor.js -->
  <!-- bower:js -->
  <script src="bower_components/video.js/dist/video.js"></script>
  <script src="bower_components/vmap-client-js/vmap-client.js"></script>
  <script src="bower_components/vast-client-js/vast-client.js"></script>
  <script src="bower_components/videojs-contrib-ads/src/videojs.ads.js"></script>
  <!-- endbower -->
  <!-- endbuild -->

  <!-- js extensions out of bower auto management -->
  <script src="bower_components/videojs-contrib-hls/dist/videojs-contrib-hls.js"></script>
  <!-- js extensions out of bower auto management -->

  <!-- build:js({.tmp,src}) scripts/scripts.js -->
  <!-- <script src="src/ott-ad-scheduler.js"></script> -->
  <script src="src/ott-player-library.js"></script>
  <!-- endbuild -->
  <script>
    var options = {
      debug: true,
      html5: {
        hls: {
          withCredentials: false
        }
      },
      plugins: {
        ottPlayerLibrary: {
          debug: true
        }
        // ads: {
        //   debug: true
        // },
        // ottAdScheduler: {
        //   debug: true,
        //   requestUrl: 'test/PlayerTestVMAP.xml',
        //   skipTime: 5,
        //   allowSkip: true
        // }
        // hls: {
        //   withCredentials: true
        // }
      }
    };

    var player = videojs('video', options).ready(function() {
      var mplayer = this;
      var tech = mplayer.tech({ IWillNotUseThisInPlugins: true });
      tech.on('loadstart', function(event) {
          console.log("loadstart");
          if(tech.hls != undefined) {
            tech.hls.xhr.beforeRequest = function(options) {
              // Only apply CROS cookie for key request, not for content
              if (options.uri.match(/(\.ts|\.m3u8)$/gi) === null) {
                options.withCredentials = true;
              } else {
                options.withCredentials = false;
              }
              return options;
            };
          }
      });
      mplayer.src([{src:'http://solutions.brightcove.com/jwhisenant/hls/apple/bipbop/bipbopall.m3u8', type:'application/x-mpegURL'}]);
      // mplayer.play();
    });
  </script>
</body>
</html>
